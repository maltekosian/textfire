package com.hogventure.basic;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.util.ArrayList;
import java.util.Properties;
import java.util.Random;

/**
 * @author aquila
 *
 */
public class UidCounter {
	static ArrayList<String> identifiers = new ArrayList<String>(); 
    /**
     * 
     */
    public UidCounter() {
    
    }
    /**
     * 
     * @param path
     */
    public void load(String path) {
        try {
            Properties p = new Properties();
            File file = new File(path+"/uidcounter.xml");
            if (file.exists()) {
                identifiers.remove(identifiers);
                identifiers = new ArrayList<String>(); 
                p.loadFromXML(new FileInputStream(file));
                String[] s = p.getProperty("UIDs").split(",");
                for (int i = 0; i < s.length; i++) {
                    identifiers.add(s[i]);
                }
            }
        } catch (Exception ex) {
        
        }
    }
    /**
     * 
     * @param path
     */
    public void save(String path) {
        try {
            Properties p = new Properties();
            File file = new File(path+"/uidcounter.xml");
            String s = "";    
            for (int i = 0; i < identifiers.size(); i++) {
                s = s + "," + identifiers.get(i);
            }
            p.setProperty("UIDs", s);
            p.storeToXML(new FileOutputStream(file), "", "UTF-16");  
        } catch (Exception ex) {
        
        }
    }
    
    /**
     * @return
     */
    public String newIdentifier() {
        String ident = "";
        Random rnd = new Random();
        while (ident.length() < 25) {
            int i = 65+(Math.abs(rnd.nextInt() % 60));
            if (i > 90) {
                i += 7;
            } 
            if (i > 122) {
                i -= 75;
            }
            ident = ident + ((char) i) ;
            if (identifiers.contains(ident)) {
                ident= "";              
            }
        }
        identifiers.add(ident);
        return ident;
    }
    
    /**
     * @param id
     */
    public static void register(String id) {
        if (!identifiers.contains(id)) {
            identifiers.add(id);
        }
    }
}
